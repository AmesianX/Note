# 坑

> 这里记录开发路上踩过的坑(;¬_¬)

## 引用传递

Java中方法的形参，8大基本类型（byte，char，short，int，long，float，double，boolean）和string为**值传递**，其余类型为内存地址的**引用传递**，注意在Android中的Adapter无法更新集合，以及浅拷贝和深拷贝的问题

## RecyclerView动画

条目动画错乱的解决方案，要支持静态动画和动态动画，并且监听动画的开始于结束，通过Map对动画条目进行记录，在onBindHolder中判断静态开启或者不开启

## RecyclerView白光一闪的动画

`public Object getChangePayload()` 这个方法返回不为null的话，on Change采用Partial bind，就不会出现。 反之就有，因此 `notifyItemChanged` 额外传入一个 `new Object()` 即可取消动画

## IM软键盘跳闪问题

由于Android没有原生的软键盘状态的监听器，以及软键盘的显示与聊天面板的Visibilty不同步问题，通过监听根布局的  `onMeasure` 方法，监听高度的变化，通过观察者模式暴露给外部来监听软键盘的状态

## 字体sp

布局宽高固定写死的地方应该统一用dp显示字体，因为一旦用户在设置中调大字体，sp的话宽高写死的话，布局显示就乱了，也可以设置成不随系统设置改变而改变，在Application中重写以下方法：

```
    @Override
    public void onConfigurationChanged(Configuration newConfig) {
        if (newConfig.fontScale != 1) {
            getResources();
        }
        super.onConfigurationChanged(newConfig);
    }

    @Override
    public Resources getResources() {
        Resources res = super.getResources();
        if (res.getConfiguration().fontScale != 1) {
            Configuration newConfig = new Configuration();
            newConfig.setToDefaults();
            res.updateConfiguration(newConfig, res.getDisplayMetrics());
        }
        return res;
    }
```

## [Androidswipelayout](https://github.com/daimajia/AndroidSwipeLayout)

在部分机型上会难以拖拽，并且自动收回


[Issue](https://github.com/daimajia/AndroidSwipeLayout/issues/412)

最后采用自定义viewgroup，通过ViewDragHelper来实现简易的拖拽，需注意在ViewPager场景下的滑动冲突

## clipChildren

在某些Android版本下，会出现一闪一闪的Bug，需要禁用硬件加速`android:layerType="none"`

## Double计算

浮点类计算时会有不精确的误差，用`BigDecimal`来做加`add`，减`subtract`，乘`multiply`，除`divide`的精确计算

## 详情页面

进入详情页面尽可能只传入ID，在详情页面中尽可能不要携带非ID数据，防止项目切换H5时高额的维护成本 

## WebView 清理历史记录失效

重写**WebViewClient**的**doUpdateVisitedHistory**方法，在里面调用WebView的**clearHistory**方法清理一次历史记录

## 性能优化之启动耗时

Debug版本测试冷启动的时间会不准确，测量Release版本

## 弱引用

实例化匿名内部类，弱引用的指向会被清除